import unittest

import math
import matplotlib.pyplot as plt
from nat.dimension import corr_dim_naive
from nat.data import logistic_map

log_map_x = [5.10000000e-001, 9.99600000e-001, 1.59936000e-003, 6.38720819e-003
    , 2.53856470e-002, 9.89648639e-002, 3.56683278e-001, 9.17841269e-001
    , 3.01634695e-001, 8.42604823e-001, 5.30487741e-001, 9.96281990e-001
    , 1.48167437e-002, 5.83888311e-002, 2.19918302e-001, 6.86216970e-001
    , 8.61292960e-001, 4.77869587e-001, 9.98040979e-001, 7.82073158e-003
    , 3.10382710e-002, 1.20299587e-001, 4.23310385e-001, 9.76474812e-001
    , 9.18870151e-002, 3.33775166e-001, 8.89477218e-001, 3.93229985e-001
    , 9.54400656e-001, 1.74080176e-001, 5.75105072e-001, 9.77436913e-001
    , 8.82159782e-002, 3.21735678e-001, 8.72887325e-001, 4.43820171e-001
    , 9.87375307e-001, 4.98612404e-002, 1.89500388e-001, 6.14359965e-001
    , 9.47687194e-001, 1.98304705e-001, 6.35919797e-001, 9.26103235e-001
    , 2.73744132e-001, 7.95233128e-001, 6.51349599e-001, 9.08373195e-001
    , 3.32925334e-001, 8.88344224e-001, 3.96755054e-001, 9.57361925e-001
    , 1.63280279e-001, 5.46479319e-001, 9.91358692e-001, 3.42665449e-002
    , 1.32369395e-001, 4.59390954e-001, 9.93403621e-001, 2.62114655e-002
    , 1.02097698e-001, 3.66695034e-001, 9.28919144e-001, 2.64113473e-001
    , 7.77430185e-001, 6.92129970e-001, 8.52344299e-001, 5.03413980e-001
    , 9.99953379e-001, 1.86475430e-004, 7.45762630e-004, 2.98082587e-003
    , 1.18877622e-002, 4.69857732e-002, 1.79112441e-001, 5.88124699e-001
    , 9.68936150e-001, 1.20395549e-001, 4.23601844e-001, 9.76653287e-001
    , 9.12065765e-002, 3.31551748e-001, 8.86500745e-001, 4.02468696e-001
    , 9.61950579e-001, 1.46406651e-001, 4.99886973e-001, 9.99999949e-001
    , 2.04400161e-007, 8.17600475e-007, 3.27039923e-006, 1.30815541e-005
    , 5.23255320e-005, 2.09291176e-004, 8.36989493e-004, 3.34515577e-003
    , 1.33358628e-002, 5.26320703e-002, 1.99447742e-001, 6.38673360e-001
    , 9.23078797e-001, 2.84017327e-001, 8.13405941e-001, 6.07106866e-001
    , 9.54112477e-001, 1.75127432e-001, 5.77831257e-001, 9.75769182e-001
    , 9.45747427e-002, 3.42521443e-001, 9.00802016e-001, 3.57430975e-001
    , 9.18696292e-001, 2.98773660e-001, 8.38031841e-001, 5.42937898e-001
    , 9.92625348e-001, 2.92810667e-002, 1.13694743e-001, 4.03072995e-001
    , 9.62420623e-001, 1.44668671e-001, 4.94958587e-001, 9.99898337e-001
    , 4.06612126e-004, 1.62578717e-003, 6.49257594e-003, 2.58016896e-002
    , 1.00543850e-001, 3.61739136e-001, 9.23535734e-001, 2.82469929e-001
    , 8.10722672e-001, 6.13805684e-001, 9.48193065e-001, 1.96491905e-001
    , 6.31531346e-001, 9.30798020e-001, 2.57652264e-001, 7.65070300e-001
    , 7.18950945e-001, 8.08241935e-001, 6.19947637e-001, 9.42450258e-001
    , 2.16951078e-001, 6.79533231e-001, 8.71071275e-001, 4.49224435e-001
    , 9.89687368e-001, 4.08251270e-002, 1.56633744e-001, 5.28398457e-001
    , 9.96774110e-001, 1.28619327e-002, 5.07860135e-002, 1.92827177e-001
    , 6.22579428e-001, 9.39897135e-001, 2.25962043e-001, 6.99612792e-001
    , 8.40618933e-001, 5.35914969e-001, 9.94840460e-001, 2.05316764e-002
    , 8.04405066e-002, 2.95879326e-001, 8.33339002e-001, 5.55540439e-001
    , 9.87661039e-001, 4.87468458e-002, 1.85482363e-001, 6.04314625e-001
    , 9.56473836e-001, 1.66526548e-001, 5.55181829e-001, 9.87819863e-001
    , 4.81271243e-002, 1.83243617e-001, 5.98661575e-001, 9.61063575e-001
    , 1.49681520e-001, 5.09107851e-001, 9.99668188e-001, 1.32680679e-003
    , 5.30018550e-003, 2.10883741e-002, 8.25746184e-002, 3.03024203e-001
    , 8.44802142e-001, 5.24445931e-001, 9.97609586e-001, 9.53880071e-003
    , 3.77912480e-002, 1.45452278e-001, 4.97183652e-001, 9.99968273e-001
    , 1.26905059e-004, 5.07555818e-004, 2.02919282e-003, 8.10030079e-003
    , 3.21387437e-002, 1.24423379e-001, 4.35768808e-001, 9.83497416e-001
    , 6.49209952e-002, 2.42825038e-001, 7.35444156e-001, 7.78264198e-001
    , 6.90276145e-001, 8.55179954e-001, 4.95388801e-001, 9.99914947e-001
    , 3.40181500e-004, 1.36026311e-003, 5.43365117e-003, 2.16165064e-002
    , 8.45969322e-002, 3.09761165e-001, 8.55236743e-001, 4.95227426e-001
    , 9.99908890e-001, 3.64406218e-004, 1.45709371e-003, 5.81988233e-003
    , 2.31440452e-002, 9.04335935e-002, 3.29021435e-001, 8.83065321e-001
    , 4.13043840e-001, 9.69754505e-001, 1.17322822e-001, 4.14232708e-001
    , 9.70575887e-001, 1.14233339e-001, 4.04736334e-001, 9.63699336e-001
    , 1.39931704e-001, 4.81403288e-001, 9.98616649e-001, 5.52574872e-003
    , 2.19808593e-002, 8.59908044e-002, 3.14385544e-001, 8.62189095e-001
    , 4.75276238e-001, 9.97554942e-001, 9.75631716e-003, 3.86445258e-002
    , 1.48604506e-001, 5.06084826e-001, 9.99851900e-001, 5.92313961e-004
    , 2.36785250e-003, 9.44898310e-003, 3.74387993e-002, 1.44148542e-001
    , 4.93478960e-001, 9.99829904e-001, 6.80267604e-004, 2.71921936e-003
    , 1.08473008e-002, 4.29185475e-002, 1.64306183e-001, 5.49238646e-001
    , 9.90302223e-001, 3.84149201e-002, 1.47756856e-001, 5.03699070e-001
    , 9.99945268e-001, 2.18917920e-004, 8.75479981e-004, 3.49885406e-003
    , 1.39464483e-002, 5.50077797e-002, 2.07927695e-001, 6.58775075e-001
    , 8.99161902e-001, 3.62679105e-001, 9.24571887e-001, 2.78954851e-001
    , 8.04556169e-001, 6.28982160e-001, 9.33454410e-001, 2.48469098e-001
    , 7.46928821e-001, 7.56104630e-001, 7.37641673e-001, 7.74105740e-001
    , 6.99464173e-001, 8.40856176e-001, 5.35268270e-001, 9.95024596e-001
    , 1.98025958e-002, 7.76418119e-002, 2.86454244e-001, 8.17592840e-001
    , 5.96539151e-001, 9.62720769e-001, 1.43557959e-001, 4.91796286e-001
    , 9.99730796e-001, 1.07652482e-003, 4.30146364e-003, 1.71318442e-002
    , 6.73533765e-002, 2.51267597e-001, 7.52528766e-001, 7.44916889e-001
    , 7.60062869e-001, 7.29469216e-001, 7.89375515e-001, 6.65047245e-001
    , 8.91037627e-001, 3.88358296e-001, 9.50144520e-001, 1.89479645e-001
    , 6.14308437e-001, 9.47734325e-001, 1.98135898e-001, 6.35512255e-001
    , 9.26545715e-001, 2.72235011e-001, 7.92492439e-001, 6.57792693e-001
    , 9.00405864e-001, 3.58700578e-001, 9.20137893e-001, 2.93936604e-001
    , 8.30151507e-001, 5.63999931e-001, 9.83616035e-001, 6.44621210e-002
    , 2.41227024e-001, 7.32146187e-001, 7.84432591e-001, 6.76392404e-001
    , 8.75542880e-001, 4.35870183e-001, 9.83549466e-001, 6.47196554e-002
    , 2.42124086e-001, 7.34000053e-001, 7.80975901e-001, 6.84210172e-001
    , 8.64266450e-001, 4.69239814e-001, 9.96215244e-001, 1.50817272e-002
    , 5.94170750e-002, 2.23546745e-001, 6.94294391e-001, 8.48998759e-001
    , 5.12799464e-001, 9.99344695e-001, 2.61950281e-003, 1.04505640e-002
    , 4.13653990e-002, 1.58617211e-001, 5.33831166e-001, 9.95421809e-001
    , 1.82289251e-002, 7.15865254e-002, 2.65847579e-001, 7.80690575e-001
    , 6.84851203e-001, 8.63320130e-001, 4.71993932e-001, 9.96862641e-001
    , 1.25100658e-002, 4.94142561e-002, 1.87889950e-001, 6.10349266e-001
    , 9.51292158e-001, 1.85341552e-001, 6.03960245e-001, 9.56769070e-001
    , 1.65448067e-001, 5.52300016e-001, 9.89058833e-001, 4.32858305e-002
    , 1.65648669e-001, 5.52836751e-001, 9.88833111e-001, 4.41687586e-002
    , 1.68871517e-001, 5.61415712e-001, 9.84912441e-001, 5.94396976e-002
    , 2.23626480e-001, 6.94470709e-001, 8.48724573e-001, 5.13564688e-001
    , 9.99263997e-001, 2.94184553e-003, 1.17327643e-002, 4.63804262e-002
    , 1.76917129e-001, 5.82469834e-001, 9.72794906e-001, 1.05859908e-001
    , 3.78614352e-001, 9.41062098e-001, 2.21856904e-001, 6.90545673e-001
    , 8.54769386e-001, 4.96554730e-001, 9.99952520e-001, 1.89909174e-004
    , 7.59492436e-004, 3.03566243e-003, 1.21057887e-002, 4.78369544e-002
    , 1.82194321e-001, 5.95998201e-001, 9.63137381e-001, 1.42015064e-001
    , 4.87387142e-001, 9.99363663e-001, 2.54372719e-003, 1.01490266e-002
    , 4.01840953e-002, 1.54277335e-001, 5.21903356e-001, 9.98080972e-001
    , 7.66138134e-003, 3.04107383e-002, 1.17943701e-001, 4.16131938e-001
    , 9.71864593e-001, 1.09375224e-001, 3.89649137e-001, 9.51290748e-001
    , 1.85346643e-001, 6.03973061e-001, 9.56758411e-001, 1.65487018e-001
    , 5.52404259e-001, 9.89015175e-001, 4.34566356e-002, 1.66272626e-001
    , 5.54504159e-001, 9.88117187e-001, 4.69664483e-002, 1.79042404e-001
    , 5.87944886e-001, 9.69062788e-001, 1.19920404e-001, 4.22158002e-001
    , 9.75762494e-001, 9.46001986e-002, 3.42604004e-001, 9.00906002e-001
    , 3.57097510e-001, 9.18315514e-001, 3.00048523e-001, 8.40077628e-001
    , 5.37388828e-001, 9.94408302e-001, 2.22417229e-002, 8.69881147e-002
    , 3.17684731e-001, 8.67044570e-001, 4.61113134e-001, 9.93951247e-001
    , 2.40486634e-002, 9.38813008e-002, 3.40270409e-001, 8.97945831e-001
    , 3.66556464e-001, 9.28771290e-001, 2.64620722e-001, 7.78386383e-001
    , 6.90004088e-001, 8.55593786e-001, 4.94212236e-001, 9.99866007e-001
    , 5.35899496e-004, 2.14244923e-003, 8.55143657e-003, 3.39132380e-002
    , 1.31052521e-001, 4.55511031e-001, 9.92082927e-001, 3.14175729e-002
    , 1.21722036e-001, 4.27623128e-001, 9.79046354e-001, 8.20583643e-002
    , 3.01299157e-001, 8.42071900e-001, 5.31947262e-001, 9.95917490e-001
    , 1.62633733e-002, 6.39955041e-002, 2.39600318e-001, 7.28768023e-001
    , 7.90660766e-001, 6.62065275e-001, 8.94939386e-001, 3.86588590e+233]


class TestCorrDimNaive(unittest.TestCase):
    def test_corr_dim_tisean_bug(self):
        curr_dim, ceil_dim = corr_dim_naive(x=log_map_x)

        self.assertTrue(math.isnan(curr_dim))

    def test_corr_dim_plot(self):
        x = logistic_map(length=500)

        corr_dim_naive(x=x, plot=True)
        plt.show()

    def test_corr_dim_logistic_short(self):
        x = logistic_map(length=200)

        curr_dim, ceil_dim = corr_dim_naive(x=x)

        self.assertAlmostEqual(2.14, curr_dim, places=2)
        self.assertEqual(3.0, ceil_dim)
