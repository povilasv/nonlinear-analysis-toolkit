import unittest
import matplotlib.pyplot as plt
from nat.dimension import corr_dim_fast
from nat.data import logistic_map
import pandas as pd

# Logistic map
# Theoretical correlation dimension value is between 0.4926 and 0.5024.
# https://en.wikipedia.org/wiki/Logistic_map

log_map_x = pd.Series([5.10000000e-01, 9.99600000e-01, 1.59936000e-03, 6.38720819e-03
                          , 2.53856470e-02, 9.89648639e-02, 3.56683278e-01, 9.17841269e-01
                          , 3.01634695e-01, 8.42604823e-01, 5.30487741e-01, 9.96281990e-01
                          , 1.48167437e-02, 5.83888311e-02, 2.19918302e-01, 6.86216970e-01
                          , 8.61292960e-01, 4.77869587e-01, 9.98040979e-01, 7.82073158e-03
                          , 3.10382710e-02, 1.20299587e-01, 4.23310385e-01, 9.76474812e-01
                          , 9.18870151e-02, 3.33775166e-01, 8.89477218e-01, 3.93229985e-01
                          , 9.54400656e-01, 1.74080176e-01, 5.75105072e-01, 9.77436913e-01
                          , 8.82159782e-02, 3.21735678e-01, 8.72887325e-01, 4.43820171e-01
                          , 9.87375307e-01, 4.98612404e-02, 1.89500388e-01, 6.14359965e-01
                          , 9.47687194e-01, 1.98304705e-01, 6.35919797e-01, 9.26103235e-01
                          , 2.73744132e-01, 7.95233128e-01, 6.51349599e-01, 9.08373195e-01
                          , 3.32925334e-01, 8.88344224e-01, 3.96755054e-01, 9.57361925e-01
                          , 1.63280279e-01, 5.46479319e-01, 9.91358692e-01, 3.42665449e-02
                          , 1.32369395e-01, 4.59390954e-01, 9.93403621e-01, 2.62114655e-02
                          , 1.02097698e-01, 3.66695034e-01, 9.28919144e-01, 2.64113473e-01
                          , 7.77430185e-01, 6.92129970e-01, 8.52344299e-01, 5.03413980e-01
                          , 9.99953379e-01, 1.86475430e-04, 7.45762630e-04, 2.98082587e-03
                          , 1.18877622e-02, 4.69857732e-02, 1.79112441e-01, 5.88124699e-01
                          , 9.68936150e-01, 1.20395549e-01, 4.23601844e-01, 9.76653287e-01
                          , 9.12065765e-02, 3.31551748e-01, 8.86500745e-01, 4.02468696e-01
                          , 9.61950579e-01, 1.46406651e-01, 4.99886973e-01, 9.99999949e-01
                          , 2.04400161e-07, 8.17600475e-07, 3.27039923e-06, 1.30815541e-05
                          , 5.23255320e-05, 2.09291176e-04, 8.36989493e-04, 3.34515577e-03
                          , 1.33358628e-02, 5.26320703e-02, 1.99447742e-01, 6.38673360e-01
                          , 9.23078797e-01, 2.84017327e-01, 8.13405941e-01, 6.07106866e-01
                          , 9.54112477e-01, 1.75127432e-01, 5.77831257e-01, 9.75769182e-01
                          , 9.45747427e-02, 3.42521443e-01, 9.00802016e-01, 3.57430975e-01
                          , 9.18696292e-01, 2.98773660e-01, 8.38031841e-01, 5.42937898e-01
                          , 9.92625348e-01, 2.92810667e-02, 1.13694743e-01, 4.03072995e-01
                          , 9.62420623e-01, 1.44668671e-01, 4.94958587e-01, 9.99898337e-01
                          , 4.06612126e-04, 1.62578717e-03, 6.49257594e-03, 2.58016896e-02
                          , 1.00543850e-01, 3.61739136e-01, 9.23535734e-01, 2.82469929e-01
                          , 8.10722672e-01, 6.13805684e-01, 9.48193065e-01, 1.96491905e-01
                          , 6.31531346e-01, 9.30798020e-01, 2.57652264e-01, 7.65070300e-01
                          , 7.18950945e-01, 8.08241935e-01, 6.19947637e-01, 9.42450258e-01
                          , 2.16951078e-01, 6.79533231e-01, 8.71071275e-01, 4.49224435e-01
                          , 9.89687368e-01, 4.08251270e-02, 1.56633744e-01, 5.28398457e-01
                          , 9.96774110e-01, 1.28619327e-02, 5.07860135e-02, 1.92827177e-01
                          , 6.22579428e-01, 9.39897135e-01, 2.25962043e-01, 6.99612792e-01
                          , 8.40618933e-01, 5.35914969e-01, 9.94840460e-01, 2.05316764e-02
                          , 8.04405066e-02, 2.95879326e-01, 8.33339002e-01, 5.55540439e-01
                          , 9.87661039e-01, 4.87468458e-02, 1.85482363e-01, 6.04314625e-01
                          , 9.56473836e-01, 1.66526548e-01, 5.55181829e-01, 9.87819863e-01
                          , 4.81271243e-02, 1.83243617e-01, 5.98661575e-01, 9.61063575e-01
                          , 1.49681520e-01, 5.09107851e-01, 9.99668188e-01, 1.32680679e-03
                          , 5.30018550e-03, 2.10883741e-02, 8.25746184e-02, 3.03024203e-01
                          , 8.44802142e-01, 5.24445931e-01, 9.97609586e-01, 9.53880071e-03
                          , 3.77912480e-02, 1.45452278e-01, 4.97183652e-01, 9.99968273e-01
                          , 1.26905059e-04, 5.07555818e-04, 2.02919282e-03, 8.10030079e-03
                          , 3.21387437e-02, 1.24423379e-01, 4.35768808e-01, 9.83497416e-01
                          , 6.49209952e-02, 2.42825038e-01, 7.35444156e-01, 7.78264198e-01
                          , 6.90276145e-01, 8.55179954e-01, 4.95388801e-01, 9.99914947e-01
                          , 3.40181500e-04, 1.36026311e-03, 5.43365117e-03, 2.16165064e-02
                          , 8.45969322e-02, 3.09761165e-01, 8.55236743e-01, 4.95227426e-01
                          , 9.99908890e-01, 3.64406218e-04, 1.45709371e-03, 5.81988233e-03
                          , 2.31440452e-02, 9.04335935e-02, 3.29021435e-01, 8.83065321e-01
                          , 4.13043840e-01, 9.69754505e-01, 1.17322822e-01, 4.14232708e-01
                          , 9.70575887e-01, 1.14233339e-01, 4.04736334e-01, 9.63699336e-01
                          , 1.39931704e-01, 4.81403288e-01, 9.98616649e-01, 5.52574872e-03
                          , 2.19808593e-02, 8.59908044e-02, 3.14385544e-01, 8.62189095e-01
                          , 4.75276238e-01, 9.97554942e-01, 9.75631716e-03, 3.86445258e-02
                          , 1.48604506e-01, 5.06084826e-01, 9.99851900e-01, 5.92313961e-04
                          , 2.36785250e-03, 9.44898310e-03, 3.74387993e-02, 1.44148542e-01
                          , 4.93478960e-01, 9.99829904e-01, 6.80267604e-04, 2.71921936e-03
                          , 1.08473008e-02, 4.29185475e-02, 1.64306183e-01, 5.49238646e-01
                          , 9.90302223e-01, 3.84149201e-02, 1.47756856e-01, 5.03699070e-01
                          , 9.99945268e-01, 2.18917920e-04, 8.75479981e-04, 3.49885406e-03
                          , 1.39464483e-02, 5.50077797e-02, 2.07927695e-01, 6.58775075e-01
                          , 8.99161902e-01, 3.62679105e-01, 9.24571887e-01, 2.78954851e-01
                          , 8.04556169e-01, 6.28982160e-01, 9.33454410e-01, 2.48469098e-01
                          , 7.46928821e-01, 7.56104630e-01, 7.37641673e-01, 7.74105740e-01
                          , 6.99464173e-01, 8.40856176e-01, 5.35268270e-01, 9.95024596e-01
                          , 1.98025958e-02, 7.76418119e-02, 2.86454244e-01, 8.17592840e-01
                          , 5.96539151e-01, 9.62720769e-01, 1.43557959e-01, 4.91796286e-01
                          , 9.99730796e-01, 1.07652482e-03, 4.30146364e-03, 1.71318442e-02
                          , 6.73533765e-02, 2.51267597e-01, 7.52528766e-01, 7.44916889e-01
                          , 7.60062869e-01, 7.29469216e-01, 7.89375515e-01, 6.65047245e-01
                          , 8.91037627e-01, 3.88358296e-01, 9.50144520e-01, 1.89479645e-01
                          , 6.14308437e-01, 9.47734325e-01, 1.98135898e-01, 6.35512255e-01
                          , 9.26545715e-01, 2.72235011e-01, 7.92492439e-01, 6.57792693e-01
                          , 9.00405864e-01, 3.58700578e-01, 9.20137893e-01, 2.93936604e-01
                          , 8.30151507e-01, 5.63999931e-01, 9.83616035e-01, 6.44621210e-02
                          , 2.41227024e-01, 7.32146187e-01, 7.84432591e-01, 6.76392404e-01
                          , 8.75542880e-01, 4.35870183e-01, 9.83549466e-01, 6.47196554e-02
                          , 2.42124086e-01, 7.34000053e-01, 7.80975901e-01, 6.84210172e-01
                          , 8.64266450e-01, 4.69239814e-01, 9.96215244e-01, 1.50817272e-02
                          , 5.94170750e-02, 2.23546745e-01, 6.94294391e-01, 8.48998759e-01
                          , 5.12799464e-01, 9.99344695e-01, 2.61950281e-03, 1.04505640e-02
                          , 4.13653990e-02, 1.58617211e-01, 5.33831166e-01, 9.95421809e-01
                          , 1.82289251e-02, 7.15865254e-02, 2.65847579e-01, 7.80690575e-01
                          , 6.84851203e-01, 8.63320130e-01, 4.71993932e-01, 9.96862641e-01
                          , 1.25100658e-02, 4.94142561e-02, 1.87889950e-01, 6.10349266e-01
                          , 9.51292158e-01, 1.85341552e-01, 6.03960245e-01, 9.56769070e-01
                          , 1.65448067e-01, 5.52300016e-01, 9.89058833e-01, 4.32858305e-02
                          , 1.65648669e-01, 5.52836751e-01, 9.88833111e-01, 4.41687586e-02
                          , 1.68871517e-01, 5.61415712e-01, 9.84912441e-01, 5.94396976e-02
                          , 2.23626480e-01, 6.94470709e-01, 8.48724573e-01, 5.13564688e-01
                          , 9.99263997e-01, 2.94184553e-03, 1.17327643e-02, 4.63804262e-02
                          , 1.76917129e-01, 5.82469834e-01, 9.72794906e-01, 1.05859908e-01
                          , 3.78614352e-01, 9.41062098e-01, 2.21856904e-01, 6.90545673e-01
                          , 8.54769386e-01, 4.96554730e-01, 9.99952520e-01, 1.89909174e-04
                          , 7.59492436e-04, 3.03566243e-03, 1.21057887e-02, 4.78369544e-02
                          , 1.82194321e-01, 5.95998201e-01, 9.63137381e-01, 1.42015064e-01
                          , 4.87387142e-01, 9.99363663e-01, 2.54372719e-03, 1.01490266e-02
                          , 4.01840953e-02, 1.54277335e-01, 5.21903356e-01, 9.98080972e-01
                          , 7.66138134e-03, 3.04107383e-02, 1.17943701e-01, 4.16131938e-01
                          , 9.71864593e-01, 1.09375224e-01, 3.89649137e-01, 9.51290748e-01
                          , 1.85346643e-01, 6.03973061e-01, 9.56758411e-01, 1.65487018e-01
                          , 5.52404259e-01, 9.89015175e-01, 4.34566356e-02, 1.66272626e-01
                          , 5.54504159e-01, 9.88117187e-01, 4.69664483e-02, 1.79042404e-01
                          , 5.87944886e-01, 9.69062788e-01, 1.19920404e-01, 4.22158002e-01
                          , 9.75762494e-01, 9.46001986e-02, 3.42604004e-01, 9.00906002e-01
                          , 3.57097510e-01, 9.18315514e-01, 3.00048523e-01, 8.40077628e-01
                          , 5.37388828e-01, 9.94408302e-01, 2.22417229e-02, 8.69881147e-02
                          , 3.17684731e-01, 8.67044570e-01, 4.61113134e-01, 9.93951247e-01
                          , 2.40486634e-02, 9.38813008e-02, 3.40270409e-01, 8.97945831e-01
                          , 3.66556464e-01, 9.28771290e-01, 2.64620722e-01, 7.78386383e-01
                          , 6.90004088e-01, 8.55593786e-01, 4.94212236e-01, 9.99866007e-01
                          , 5.35899496e-04, 2.14244923e-03, 8.55143657e-03, 3.39132380e-02
                          , 1.31052521e-01, 4.55511031e-01, 9.92082927e-01, 3.14175729e-02
                          , 1.21722036e-01, 4.27623128e-01, 9.79046354e-01, 8.20583643e-02
                          , 3.01299157e-01, 8.42071900e-01, 5.31947262e-01, 9.95917490e-01
                          , 1.62633733e-02, 6.39955041e-02, 2.39600318e-01, 7.28768023e-01
                          , 7.90660766e-01, 6.62065275e-01, 8.94939386e-01, 0.00000000e+00])


class TestCorrDimFast(unittest.TestCase):
    def test_corr_dim(self):
        curr_dim, ceil_dim = corr_dim_fast(x=log_map_x, d=1, min_m=1, max_m=10)

        self.assertAlmostEqual(0.73, curr_dim, places=2)
        self.assertEqual(1.0, ceil_dim)

    def test_corr_dim_plot(self):
        corr_dim_fast(x=log_map_x, plot=True)

    def test_corr_dim_logistic_short(self):
        x = logistic_map(length=200)

        curr_dim, ceil_dim = corr_dim_fast(x=x)

        self.assertAlmostEqual(0.71, curr_dim, places=2)
        self.assertEqual(1.0, ceil_dim)
